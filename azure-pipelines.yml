# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
  - none

pool:
  vmImage: 'ubuntu-latest'

jobs:
  - job: CreateWindowsVM
    displayName: 'Create Windows VM'
    steps:
      - checkout: self
      - task: AzureCLI@2
        displayName: 'Create Azure VM'
        inputs:  
          azureSubscription: 'windowsVM-azurepipeline'
          scriptType: 'bash'
          scriptLocation: 'inlineScript'
          inlineScript: |
            az vm create \
              --resource-group azurepipeline \
              --name windows \
              --image syncfusion:bold-bi-enterprise-multi-tenant:-bring-your-own-license:6.4.6 \
              --public-ip-sku Standard \
              --size Standard_D2s_v3 \
              --admin-username syncfusion \
              --admin-password Syncfusion@123 \
              --nsg-name newip
              --nsg-rule SSH \
              --nsg-rule RDP \
              --public-ip-address-allocation static
            # Open port 80
            az network nsg rule create --resource-group azurepipeline --nsg-name newip --name AllowHTTP --priority 100 --destination-port-ranges 80 --access Allow --protocol Tcp
      
            # Open port 443
            az network nsg rule create --resource-group azurepipeline --nsg-name newip --name AllowHTTPS --priority 101 --destination-port-ranges 443 --access Allow --protocol Tcp  